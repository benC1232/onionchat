<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Get Path Form</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
  <form>
    <label for="ip">Server IP:</label>
    <input type="text" id="ip" name="ip" value="127.0.0.1"><br><br>
    <label for="port">Server Port:</label>
    <input type="text" id="port" name="port" value="60005"><br><br>
    <button type="button" onclick="get_path()">Get Path</button>
  </form>
  <div id="path"></div>
  <div id="error"></div>
  <script>
    const net = require('net');
    const fs = require('fs');

    function get_path() {
    var HOST = document.getElementById("ip").value;
    var PORT = document.getElementById("port").value;

    const s = new net.Socket();
    
    s.connect({port: +PORT}, {host: HOST}, {onread: function() {
        const request = parse_request(150, "");
        console.log(request);
        s.write(request);
    }});
    
    s.on('data', function(data) {
        console.log(data);
        const response = data.slice(5, get_len(data) + 5);
        console.log(response);
        localStorage.setItem("path", parse_response(response));
        displayPath(parse_response(response));
    });
    
    s.on('close', function() {
        console.log('Connection closed');
        s.destroy();
    });

    s.on('error', function(err) {
        console.log('Socket error: ' + err);
        s.destroy();
        displayError('Error connecting to server: ' + err.message);
    });
}

function parse_request(code, json) {
    const codeBytes = Buffer.alloc(1);
    codeBytes.writeUInt8(code);
    const jsonBytes = Buffer.from(json, 'utf8');
    const lenBytes = Buffer.alloc(4);
    lenBytes.writeUInt32BE(jsonBytes.length);
    return Buffer.concat([codeBytes, lenBytes, jsonBytes]);
}

function displayPath(path) {
    const pathEl = document.getElementById('path');
    pathEl.innerHTML = '';
    for (let i = 0; i < path.length; i++) {
        const node = path[i];
        const nodeEl = document.createElement('div');
        nodeEl.innerHTML = `Node ${i+1}: ${node.ip}:${node.port} (encryption: ${node.encryption})`;
        pathEl.appendChild(nodeEl);
    }
}

function displayError(message) {
    const errorEl = document.getElementById('error');
    errorEl.innerHTML = message;
}
    
  </script>
</body>
</html>